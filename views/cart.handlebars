<div class="w-full h-fit text-black px-3 py-5 flex justify-center items-center md:mt-12">
  <div class="max-w-screen-2xl w-full h-fit flex flex-col gap-5 items-center">
   <div class="grid grid-cols-1 w-full md:w-[70%] h-fit md:grid-cols-3 md:gap-10 ">
    <div class="flex flex-col gap-5 p-3 h-fit md:h-[400px] md:overflow-auto custom-scrollbar md:border border-red-500 col-span-2 md:shadow-md md:p-5 md:rounded-md">
      <div class="flex items-center gap-2 font-bold">
        <div class="bg-gradient-to-b from-orange-400 to-red-600 w-1 h-5"></div>
        <h2>Meu <span class="text-orange-500">carrinho</span></h2>
      </div>
      <div class="flex flex-col items-center gap-3 w-full">
        {{#each produtos}}
        <div class="flex items-center justify-between p-2 gap-2 w-full border border-gray-50 shadow-md rounded-md">
            <img src="/images/{{imagem}}.png" class="w-16 h-16" alt="">
          <div class="flex justify-between items-center w-full">
            <div class="w-fit h-fit flex flex-col gap-3">
              <p class="text-sm">{{nome}}</p>
              <span class="text-teal-500 text-sm">R$: {{valor}},00</span>
            </div>
            <div class="flex flex-col gap-3">
              <button class="self-end delete" data-product-id="{{ProdutoId}}"><i class="fa-solid fa-trash text-red-500"></i></button>
              <div class="border border-yellow-500 rounded-full flex jusitfy-center items-center text-sm">
                <button class="md:w-8 w-5 flex items-center justify-center decrease" data-product-id="{{ProdutoId}}">-</button>
                <span class="md:w-8 w-4 border-r border-l border-yellow-500 text-teal-500 flex items-center justify-center">{{quantidade}}</span>
                <button class="md:w-8 w-5 flex items-center justify-center increase" data-product-id="{{ProdutoId}}">+</button>
              </div>
            </div>
          </div>
        </div>
        {{else}}
        <p>nenhum produto no carrinho</p>
        {{/each}}
            </div>
          </div>
          <div class="flex flex-col gap-3 w-full md:w-72">
      <div class="flex flex-col gap-5 items-center justify-center p-5 rounded-md shadow-md border-gray-50 w-full h-fit"> 
        <div class="flex items-center gap-2 w-full font-bold">
          <div class="bg-gradient-to-b from-orange-400 to-red-600 w-1 h-5"></div>
                <h2>VocÃª <span class="text-orange-500">prefere</span></h2>
        </div>
      <div class="flex justify-center items-center gap-11 ">
        <div class=" border border-red-500 w-max h-max p-3 rounded-md ">
          <img src="/images/moto.png" class="w-12" alt="">
          <p class="text-sm">Delivery</p>
        </div>
        <div class="">
          <img src="/images/retirar.png" class="w-8">
          <p class="text-sm">Retirar</p>
        </div>
      </div>
      </div>
      <div class="flex flex-col items-center justify-center p-5 rounded-md shadow-md border-gray-50 w-full h-[60%]">
        <div class="flex items-center gap-2 w-full">
          <div class="bg-gradient-to-b from-orange-400 to-red-600 w-1 h-5"></div>
          <h2 class="font-bold">Pagamento</h2>
        </div>
        <div class="flex flex-col w-full gap-1 p-3">
          <div class="flex items-center justify-between gap-10 text-[10px] text-zinc-500">
            <p>Subtotal</p>
            <p>99,99</p>
          </div>
          <div class="flex items-center justify-between gap-10 text-[10px] text-zinc-500">
            <p>Frete</p>
            <p>03,00</p>
          </div>
          <div class="flex items-center justify-between gap-10 text-[10px] text-zinc-500">
            <p>Descontos</p>
            <p>99,99</p>
          </div>
          <div class="border border-yellow-500 w-full"></div>
          <div class="flex items-center justify-between text-[14px]">
            <p>Total a pagar:</p>
            <p>R$:50,00</p>
          </div>
        </div>
        <button class="px-8 py-2 bg-red-500 text-white rounded-full">Pedir agora!</button>

      </div>
    </div>
   </div>
  </div> 
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
  const decreaseButtons = document.querySelectorAll('.decrease');
  const increaseButtons = document.querySelectorAll('.increase');
  const deleteButtons = document.querySelectorAll('.delete');

  decreaseButtons.forEach(button => {
    button.addEventListener('click', function () {
      updateQuantity(this.dataset.productId, -1);
    });
  });

  increaseButtons.forEach(button => {
    button.addEventListener('click', function () {
      updateQuantity(this.dataset.productId, 1);
    });
  });

  deleteButtons.forEach(button => {
    button.addEventListener('click', function () {
      deleteProduct(this.dataset.productId);
    });
  });
});

function updateQuantity(productId, change) {
  const quantityDisplay = document.querySelector(`#quantity_${productId}`);
  let quantity = parseInt(quantityDisplay.textContent) + change;
  quantity = Math.max(1, quantity);  // Ensure quantity is at least 1

  // Update the display
  quantityDisplay.textContent = quantity;

  // Send the update to server
  fetch(`/carrinho/update/${productId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ quantity: quantity })
  })
  .then(response => response.json())
  .then(data => {
    console.log('Success:', data);
  })
  .catch((error) => {
    console.error('Error:', error);
  });
}

function deleteProduct(productId) {
  // Send the delete request to server
  fetch(`/carrinho/delete/${productId}`, {
    method: 'DELETE'
  })
  .then(response => response.json())
  .then(data => {
    console.log('Product deleted:', data);
    document.querySelector(`#product_${productId}`).remove();
  })
  .catch((error) => {
    console.error('Error:', error);
  });
}
</script>
        </div>
      </div>
    </div>